#include <BLEDevice.h>
#include <BLEUtils.h>
#include <BLEServer.h>
#include <BLEAdvertising.h>

#define DEVICE_NAME "CampusQuiet_Beacon"

void setup() {
  Serial.begin(115200);
  delay(1000);

  // Initialize BLE
  BLEDevice::init(DEVICE_NAME);

  // Set maximum transmit power (IMPORTANT for range)
  esp_ble_tx_power_set(ESP_BLE_PWR_TYPE_ADV, ESP_PWR_LVL_P9);

  // Create BLE server
  BLEServer *pServer = BLEDevice::createServer();

  // Advertising object
  BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();

  // Create BLE advertisement data
  BLEAdvertisementData advData;
  advData.setName(DEVICE_NAME);
  advData.setCompleteServices(BLEUUID("12345678-1234-1234-1234-1234567890ab"));

  pAdvertising->setAdvertisementData(advData);

  // Advertising settings (important)
  pAdvertising->setScanResponse(false);
  pAdvertising->setMinPreferred(0x06);
  pAdvertising->setMinPreferred(0x12);

  // Start advertising
  BLEDevice::startAdvertising();

  Serial.println("âœ… BLE Beacon started");
}

void loop() {
  // Nothing required here
  delay(2000);
}
